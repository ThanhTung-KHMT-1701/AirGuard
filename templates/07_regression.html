{% extends "base.html" %}

{% block title %}Mô hình hồi quy - AirGuard{% endblock %}

{% block content %}
<div class="container">
    <h2>07. Mô hình hồi quy (Regression)</h2>
    
    <div style="margin: 2em 0;">
        <h3>Tổng quan</h3>
        <p style="font-size: 1.05em; line-height: 1.8;">
            Mô hình hồi quy được sử dụng để dự đoán giá trị cụ thể của nồng độ PM2.5 (µg/m³) 
            dựa trên các đặc trưng môi trường và khí tượng.
        </p>
    </div>

    {% if data.metrics %}
    <div style="margin: 2em 0;">
        <h3>Kết quả đánh giá
            <a href="{{ url_for('serve_processed_data', filename=data.metrics_file) }}" target="_blank" style="font-size: 0.7em; font-weight: normal; margin-left: 1em;">(Xem file gốc)</a>
        </h3>
        <div class="metrics-grid">
            {% for key, value in data.metrics.items() %}
            <div class="metric-card">
                <h4>{{ key.replace('_', ' ').title() }}</h4>
                {% if value is number %}
                <div class="value">
                    {{ "%.4f"|format(value) }}
                </div>
                {% else %}
                <pre class="metric-pre"><code>{{ value | pretty_json }}</code></pre>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="image-grid">
        {% if data.images.actual_vs_predicted %}
        <div class="image-container">
            <h3>Actual vs Predicted</h3>
            <img src="{{ data.images.actual_vs_predicted }}" alt="Actual vs Predicted" class="zoomable-img">
            <p class="image-caption">So sánh giá trị thực tế và dự đoán của PM2.5. (Nhấp vào ảnh để phóng to)</p>
        </div>
        {% endif %}

        {% if data.images.target_distribution %}
        <div class="image-container">
            <h3>Phân bố mục tiêu</h3>
            <img src="{{ data.images.target_distribution }}" alt="Target Distribution" class="zoomable-img">
            <p class="image-caption">Phân bố của giá trị PM2.5 trong dữ liệu. (Nhấp vào ảnh để phóng to)</p>
        </div>
        {% endif %}
    </div>

    {% if data.missing_values is not none %}
    <div style="margin: 2em 0;">
        <h3>Thống kê giá trị thiếu
            <a href="{{ url_for('serve_processed_data', filename=data.missing_values_file) }}" target="_blank" style="font-size: 0.7em; font-weight: normal; margin-left: 1em;">(Xem file gốc)</a>
        </h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        {% for col in data.missing_values.columns %}
                        <th>{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for _, row in data.missing_values.iterrows() %}
                    <tr>
                        {% for val in row %}
                        <td>{{ "%.2f"|format(val) if val is number else val }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    {% if data.predictions_sample is not none %}
    <div style="margin: 2em 0;">
        <h3>Mẫu dự đoán (10 dòng đầu)
            <a href="{{ url_for('serve_processed_data', filename=data.predictions_sample_file) }}" target="_blank" style="font-size: 0.7em; font-weight: normal; margin-left: 1em;">(Xem file gốc)</a>
        </h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        {% for col in data.predictions_sample.columns %}
                        <th>{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for _, row in data.predictions_sample.iterrows() %}
                    <tr>
                        {% for val in row %}
                        <td>{{ "%.2f"|format(val) if val is number else val }}</td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}

    <div style="margin: 3em 0; padding: 2em; background-color: #f8f9fa; border-radius: 12px; border-left: 5px solid #FF9A1F; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">
        <h3 style="margin-top: 0;">Các chỉ số đánh giá</h3>
        <ul style="line-height: 2; font-size: 1.05em; padding-left: 1.5em;">
            <li><strong>MAE (Mean Absolute Error)</strong>: Sai số tuyệt đối trung bình</li>
            <li><strong>MSE (Mean Squared Error)</strong>: Sai số bình phương trung bình</li>
            <li><strong>RMSE (Root Mean Squared Error)</strong>: Căn bậc hai của MSE</li>
            <li><strong>R² Score</strong>: Hệ số xác định, đo lường mức độ phù hợp của mô hình</li>
        </ul>
    </div>
</div>
{% endblock %}
